services:
  # SDR Signal Receiver
  rtl_433:
    image: hertzg/rtl_433:latest
    container_name: etherspy-sdr
    restart: always
    devices:
      - "/dev/bus/usb:/dev/bus/usb"
    command:
      - "-F"
      - "mqtt://${MQTT_BROKER:-192.168.1.125}:1883,user=${MQTT_USER:-},pass=${MQTT_PASS:-},retain=0,devices=rtl_433[/model][/id]"
      - "-M"
      - "level"
      - "-M"
      - "metadata"
      - "-M"
      - "time:iso8601"
    environment:
      - TZ=Europe/Stockholm
      - MQTT_USER=${MQTT_USER:-}
      - MQTT_PASS=${MQTT_PASS:-}

  # Python Backend & Dashboard Web Server
  etherspy-backend:
    image: etherspy-backend:latest
    container_name: etherspy-backend
    restart: always
    ports:
      - "5000:5000"
    environment:
      - MQTT_BROKER=${MQTT_BROKER:-192.168.1.125}
      - MQTT_PORT=1883
      - MQTT_USER=${MQTT_USER:-}
      - MQTT_PASS=${MQTT_PASS:-}
      - DB_PATH=/app/data/etherspy.db
    volumes:
      - ./data:/app/data
